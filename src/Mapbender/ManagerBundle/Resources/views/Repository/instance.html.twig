{% extends "MapbenderManagerBundle::manager.html.twig" %}
{%- set _h1_text = instance.source.title -%}
{%- set _h1_subtext = ('mb.terms.sourceinstance.typed.singular' | trans({'%type%': instance.source.type})) ~ ' ' ~ instance.source.id ~ '/'~ instance.id -%}
{%- set title = _h1_subtext ~ ' - ' ~ _h1_text -%}

{% form_theme form _self %}

{% block checkbox_row %}
    {% if form.parent and form.parent.parent and 'source_instance_layer_collection' in form.parent.parent.vars.block_prefixes %}
        {% set _columnClass = ('checkboxColumn ' ~ (form.vars.columnClass | default(''))) | trim %}
        {% set _tagName = tagName | default('td') %}
        <{{ _tagName }} class="{{_columnClass}}" data-check-identifier="{{ form.vars.checkbox_group }}" title="{{ form.vars.label | trans }}">
            <div class="checkWrapper {{ checked ? 'iconCheckboxActive' : 'iconCheckbox' }}">
                <input class="checkbox" type="checkbox" {{ block('widget_attributes') }}{% if value is defined %} value="{{ value }}"{% endif %}{% if checked %} checked="checked"{% endif %} />
            </div>
        </{{ _tagName }}>
    {% else %}
        <div>
            {{ form_widget(form) }}
            {{ form_label(form) }}
        </div>
    {% endif %}
{% endblock %}

{% block js %}
  {{parent()}}
  <script type="text/javascript" src="{{ asset('bundles/mapbendermanager/js/repository.js') }}"></script>
{% endblock %}
{%- set _is_reusable_instance = not form.vars.data.layerset %}

{% block heading %}
    <div class="contentTitle">
      <div class="row">
        <div class="col-xs-8 col-8">
          <h1>
            {{- _h1_text | default(title) -}}
          </h1>
          <p>
            {{- (_h1_subtext | trim) ~ ' ' -}}
            (
            {{- not _is_reusable_instance ? ('mb.terms.sourceinstance.reusable.singular' | trans) : ('mb.terms.sourceinstance.bound.singular' | trans) -}}
            )
          </p>
        </div>
        <div class="col-xs-4 col-4 text-right">
          <p>
            <a class="btn btn-default" href="{{ path('mapbender_manager_repository_view', {'sourceId': form.vars.data.source.id}) }}">{{ 'mb.terms.source.singular' | trans }}&nbsp;<i class="fa fa-desktop"></i></a>
          </p>
          <p>
            {%- if _is_reusable_instance and layerset is defined and layerset -%}
            <a class="btn btn-sm btn-info" href="{{ path('mapbender_manager_application_sharedinstancecopy', {'instance': instance, 'layerset': layerset}) }}"><i class="fa fas fa-anchor"></i>&nbsp;{{ 'mb.manager.sourceinstance.convert_to_bound' | trans }}</a>
            {%- endif -%}
            {%- if not _is_reusable_instance -%}
            <a class="btn btn-sm btn-info" href="{{ path('mapbender_manager_repository_promotetosharedinstance', {'instance': instance}) }}"><i class="fa fas fa-wifi"></i>&nbsp;{{ 'mb.manager.sourceinstance.convert_to_reusable' | trans }}</a>
            {%- endif -%}
          <p>
        </div>
      </div>
    </div>
{% endblock heading %}

{% block manager_content %}
<div class="instanceContainer">
  {{ form_start(form) }}

    <div class="form-group">
        <div class="right">
          <input type="submit" name="save" class="btn btn-sm btn-success" value="{{"mb.actions.save"|trans}}" />
        {% if app.request.attributes.get('slug') %}
          <a href="{{ path('mapbender_manager_application_edit', {'slug': app.request.attributes.get('slug')}) }}#tabLayers" class="btn btn-sm btn-warning">{{"mb.actions.back"|trans}}</a>
        {% elseif layerset is defined and layerset %}
            <a href="{{ path('mapbender_manager_application_edit', {'slug': layerset.application.slug}) }}#tabLayers" class="btn btn-sm btn-warning">{{"mb.actions.back"|trans}}</a>
        {% endif %}
        </div>
        <span class="labelInput">{{ 'mb.wms.wmsloader.repo.instance.label.originurl' | trans }}</span>
        <a class="smallText origin-url" href="{{ instance.source.originUrl }}" target="_blank">{{ instance.source.originUrl }}</a>
        <div class="clear"></div>
    </div>


    <div class="row">
      {% block form_main %}
      <div class="col-md-6 col-xs-12">
        {% block form_main1 %}
            {{ form_row(form.title) }}
            {{ form_row(form.opacity) }}
        {% endblock form_main1 %}
      </div>
      <div class="col-md-6 col-xs-12">
        {% block form_main2 %}
            {{ form_row(form.basesource) }}
            {{ form_row(form.proxy) }}
        {% endblock form_main2 %}
      </div>
      {% endblock form_main %}
    </div>
    {% block form_layers %}
    {% endblock form_layers %}
    <div class="button-group">
      <input type="submit" name="save" class="btn btn-sm btn-success" value="{{"mb.wms.wmsloader.repo.instance.btn.save"|trans}}" />
        {% if app.request.attributes.get('slug') %}
          <a href="{{ path('mapbender_manager_application_edit', {'slug': app.request.attributes.get('slug')}) }}#tabLayers" class="btn btn-sm btn-warning">{{"mb.actions.back"|trans}}</a>
        {% elseif layerset is defined and layerset %}
            <a href="{{ path('mapbender_manager_application_edit', {'slug': layerset.application.slug}) }}#tabLayers" class="btn btn-sm btn-warning">{{"mb.actions.back"|trans}}</a>
        {% endif %}
    </div>
    {{ form_row(form._token) }}
  {# suppress visible post-form 'dimensions' collection'; @todo: fix dimensions integration into form #}
  {{ form_end(form, {"render_rest": false}) }}
</div>
{% endblock manager_content %}



